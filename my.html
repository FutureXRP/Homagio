<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Homagio — My Houses</title>
  <meta name="description" content="Create and manage your homes in Homagio." />
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#07090d" />

  <style>
    :root{
      color-scheme: dark;

      --bg0:#07090d;
      --bg1:#0b0f16;
      --card0: rgba(255,255,255,.06);
      --card1: rgba(255,255,255,.09);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.16);

      --text0: rgba(255,255,255,.92);
      --text1: rgba(255,255,255,.70);
      --text2: rgba(255,255,255,.55);

      --brand:#2d6cdf;
      --brand2:#1f4fb0;

      --radius:18px;
      --radius2:26px;

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 10px 30px rgba(0,0,0,.45);

      --max: 1180px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(900px 500px at 20% -10%, rgba(45,108,223,.22), transparent 60%),
        radial-gradient(900px 500px at 80% -10%, rgba(120,70,255,.16), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color: var(--text0);
    }

    a{ color:inherit; text-decoration:none; }
    .wrap{ max-width: var(--max); margin:0 auto; padding: 20px 18px 28px; }

    /* ---------- App Shell ---------- */
    .app-header{
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(10px);
      background: rgba(7,9,13,.72);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .app-header .wrap{ padding: 14px 18px; }
    .bar{
      display:flex;
      align-items:center;
      gap:14px;
      justify-content:space-between;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 170px;
    }
    .logo{
      width: 38px;
      height: 38px;
      border-radius: 14px;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,0.25), transparent 40%),
        linear-gradient(180deg, rgba(45,108,223,0.98), rgba(31,79,176,0.98));
      box-shadow:
        0 0 0 6px rgba(45,108,223,.22),
        0 14px 34px rgba(0,0,0,.40);
      display:grid;
      place-items:center;
      border: 1px solid rgba(255,255,255,.12);
    }
    .logo svg{ opacity:.96 }
    .brand h1{
      font-size: 14px;
      margin:0;
      letter-spacing:.3px;
      line-height:1.1;
    }
    .brand span{
      display:block;
      font-size: 12px;
      color: var(--text2);
      margin-top:2px;
    }

    .nav{
      display:flex;
      gap: 8px;
      align-items:center;
      flex-wrap: wrap;
      justify-content:center;
    }
    .nav a{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid transparent;
      color: var(--text1);
      font-size: 13px;
    }
    .nav a:hover{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.08);
      color: var(--text0);
    }
    .nav a.active{
      background: rgba(45,108,223,.14);
      border-color: rgba(45,108,223,.28);
      color: rgba(255,255,255,.92);
    }

    .right{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 170px;
      justify-content:flex-end;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--text1);
      font-size: 13px;
      box-shadow: var(--shadow2);
      white-space: nowrap;
    }
    .dot{
      width:8px; height:8px; border-radius:99px;
      background: rgba(255,255,255,.35);
      box-shadow: 0 0 0 4px rgba(255,255,255,.08);
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.90);
      font-weight: 600;
      font-size: 13px;
      cursor:pointer;
      user-select:none;
      box-shadow: var(--shadow2);
    }
    .btn:hover{ background: rgba(255,255,255,.09); }
    .btn.primary{
      border-color: rgba(45,108,223,.35);
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,.16), transparent 46%),
        linear-gradient(180deg, rgba(45,108,223,.96), rgba(31,79,176,.96));
    }
    .btn.primary:hover{ filter: brightness(1.05); }

    /* ---------- Page ---------- */
    .page-head{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 14px;
      padding: 18px 0 12px;
    }
    .page-head h2{
      margin:0;
      font-size: 22px;
      letter-spacing:.2px;
    }
    .page-head p{
      margin:6px 0 0;
      color: var(--text2);
      font-size: 13px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 16px;
      align-items:start;
    }
    @media (max-width: 960px){
      .grid{ grid-template-columns: 1fr; }
      .right{ display:none; }
      .brand{ min-width:auto; }
    }

    .card{
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding: 16px 16px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }
    .card .hd h3{
      margin:0;
      font-size: 14px;
      letter-spacing:.25px;
    }
    .card .bd{ padding: 16px; }

    .muted{ color: var(--text2); font-size: 13px; }

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .form .full{ grid-column: 1 / -1; }

    label{
      display:block;
      font-size: 12px;
      color: var(--text2);
      margin-bottom: 6px;
    }
    input, select, textarea{
      width: 100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      color: var(--text0);
      outline:none;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(45,108,223,.55);
      box-shadow: 0 0 0 4px rgba(45,108,223,.18);
    }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .list{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .house{
      display:flex;
      gap: 12px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      align-items:flex-start;
    }
    .house:hover{ background: rgba(255,255,255,.07); }
    .badge{
      width: 42px;
      height: 42px;
      border-radius: 16px;
      background: rgba(45,108,223,.18);
      border: 1px solid rgba(45,108,223,.25);
      display:grid;
      place-items:center;
      flex: 0 0 auto;
    }
    .house h4{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .house .meta{
      margin-top: 3px;
      color: var(--text2);
      font-size: 12px;
      line-height: 1.35;
    }
    .house .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .house .mini{
      display:flex;
      gap: 8px;
      align-items:center;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    .chip{
      font-size: 12px;
      color: var(--text1);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
    }
    .danger{
      border-color: rgba(255,80,80,.28);
      background: rgba(255,80,80,.10);
    }
  </style>
</head>

<body>
  <!-- App Shell Header -->
  <header class="app-header">
    <div class="wrap">
      <div class="bar">
        <a class="brand" href="index.html" aria-label="Homagio Home">
          <div class="logo" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M12 3l9 7v10a2 2 0 0 1-2 2h-5v-7H10v7H5a2 2 0 0 1-2-2V10l9-7z" stroke="rgba(255,255,255,.92)" stroke-width="1.8" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <h1>Homagio</h1>
            <span>Manage your homes</span>
          </div>
        </a>

        <nav class="nav" aria-label="Primary">
          <a href="explore.html">Explore</a>
          <a class="active" href="my.html">My Houses</a>
        </nav>

        <div class="right">
          <div class="pill" title="Auth coming next">
            <span class="dot"></span>
            Guest Mode
          </div>
          <a class="btn primary" href="my.html">New House</a>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="page-head">
      <div>
        <h2>My Houses</h2>
        <p>Start a home profile, add photos, track finishes, and build a clean materials list.</p>
      </div>
      <div class="actions" style="margin:0;">
        <a class="btn" href="explore.html">Open Explore</a>
        <button class="btn primary" id="scrollToCreate">Create a house</button>
      </div>
    </div>

    <section class="grid">
      <!-- Left: List -->
      <div class="card">
        <div class="hd">
          <h3>Your homes</h3>
          <div class="muted" id="countLabel">Loading…</div>
        </div>
        <div class="bd">
          <div class="list" id="housesList"></div>
          <div class="muted" id="emptyState" style="display:none; margin-top:10px;">
            No homes yet. Create your first home on the right → then open it to add materials and photos.
          </div>
        </div>
      </div>

      <!-- Right: Create -->
      <div class="card" id="createCard">
        <div class="hd">
          <h3>Create a house</h3>
          <div class="muted">Stored locally for now</div>
        </div>
        <div class="bd">
          <form id="createForm">
            <div class="form">
              <div class="full">
                <label>House name</label>
                <input id="name" placeholder="e.g., Blair Family Home" required />
              </div>

              <div class="full">
                <label>Address</label>
                <input id="address" placeholder="123 Main St, Tulsa, OK" required />
              </div>

              <div>
                <label>Style (optional)</label>
                <input id="style" placeholder="Modern farmhouse, Craftsman…" />
              </div>

              <div>
                <label>Target budget (optional)</label>
                <input id="budget" type="number" min="0" step="1" placeholder="250000" />
              </div>

              <div class="full">
                <label>Notes (optional)</label>
                <textarea id="notes" rows="3" placeholder="Quick description or priorities…"></textarea>
              </div>
            </div>

            <div class="actions">
              <button class="btn" type="button" id="seedDemo">Seed demo</button>
              <button class="btn primary" type="submit">Create house</button>
            </div>

            <div class="muted" style="margin-top:10px;">
              Next backend step: Firebase Auth + Firestore so this syncs across devices.
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>

  <!-- DB + Page Logic -->
  <script src="assets/db.js"></script>
  <script>
    // Lightweight page controller using HomagioDB (localStorage MVP)
    const listEl = document.getElementById('housesList');
    const emptyEl = document.getElementById('emptyState');
    const countLabel = document.getElementById('countLabel');

    const form = document.getElementById('createForm');
    const btnSeed = document.getElementById('seedDemo');
    const scrollBtn = document.getElementById('scrollToCreate');
    const createCard = document.getElementById('createCard');

    function escapeHtml(s){
      return String(s ?? '')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    function render(){
      const homes = (HomagioDB.getHomes && HomagioDB.getHomes()) || [];
      countLabel.textContent = `${homes.length} total`;
      listEl.innerHTML = '';

      if(!homes.length){
        emptyEl.style.display = 'block';
        return;
      }
      emptyEl.style.display = 'none';

      for(const h of homes){
        const name = escapeHtml(h.name || 'Untitled');
        const addr = escapeHtml(h.address || '');
        const style = escapeHtml(h.style || '');
        const budget = h.budget ? `$${Number(h.budget).toLocaleString()}` : '';

        const el = document.createElement('a');
        el.className = 'house';
        el.href = `house.html?id=${encodeURIComponent(h.id)}`;
        el.innerHTML = `
          <div class="badge" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 3l9 7v10a2 2 0 0 1-2 2h-5v-7H10v7H5a2 2 0 0 1-2-2V10l9-7z"
                stroke="rgba(255,255,255,.88)" stroke-width="1.8" stroke-linejoin="round"/>
            </svg>
          </div>
          <div style="flex:1;">
            <div class="row">
              <h4>${name}</h4>
              <span class="muted">Open →</span>
            </div>
            <div class="meta">${addr}</div>
            <div class="mini">
              ${style ? `<span class="chip">${style}</span>` : ''}
              ${budget ? `<span class="chip">${budget}</span>` : ''}
              <span class="chip">Local</span>
            </div>
          </div>
        `;
        listEl.appendChild(el);
      }
    }

    // Address -> Lat/Lng using free Nominatim (no key)
    async function geocode(address){
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;
      const res = await fetch(url, { headers: { 'Accept':'application/json' }});
      const data = await res.json();
      if(!data || !data.length) return null;
      return { lat: parseFloat(data[0].lat), lng: parseFloat(data[0].lon) };
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = document.getElementById('name').value.trim();
      const address = document.getElementById('address').value.trim();
      const style = document.getElementById('style').value.trim();
      const budget = document.getElementById('budget').value.trim();
      const notes = document.getElementById('notes').value.trim();

      const btn = form.querySelector('button[type="submit"]');
      const old = btn.textContent;
      btn.textContent = 'Creating…';
      btn.disabled = true;

      try{
        const geo = await geocode(address);
        const lat = geo ? geo.lat : null;
        const lng = geo ? geo.lng : null;

        const home = {
          name,
          address,
          style,
          budget: budget ? Number(budget) : null,
          notes,
          lat,
          lng,
          createdAt: Date.now()
        };

        const id = HomagioDB.addHome ? HomagioDB.addHome(home) : null;
        render();

        // Go straight to the house page
        if(id){
          window.location.href = `house.html?id=${encodeURIComponent(id)}`;
        }else{
          alert('Created, but could not navigate (DB function missing).');
        }
      }catch(err){
        console.error(err);
        alert('Could not create house. Check console for details.');
      }finally{
        btn.textContent = old;
        btn.disabled = false;
      }
    });

    btnSeed.addEventListener('click', () => {
      // Seed demo around Tulsa-ish if DB provides it; otherwise safe no-op
      try{
        if(HomagioDB.seedDemoNear){
          HomagioDB.seedDemoNear(36.1540, -95.9928, true);
        }else if(HomagioDB.seedDemo){
          HomagioDB.seedDemo(true);
        }
      }catch(e){}
      render();
    });

    scrollBtn.addEventListener('click', () => {
      createCard.scrollIntoView({ behavior:'smooth', block:'start' });
    });

    render();
  </script>
</body>
</html>
